import pickle
from transformers import BertTokenizer, BertForSequenceClassification
import torch

model_path = "saved_bert_model"
model = BertForSequenceClassification.from_pretrained(model_path)
tokenizer = BertTokenizer.from_pretrained(model_path)

with open("label_encoder.pkl", "rb") as f:
    label_encoder = pickle.load(f)

def predict(text):
    inputs = tokenizer(text, return_tensors="pt", truncation=True, padding=True, max_length=512)
    with torch.no_grad():
        outputs = model(**inputs)
        probs = torch.nn.functional.softmax(outputs.logits, dim=-1)
    pred_id = probs.argmax().item()
    pred_label = label_encoder.inverse_transform([pred_id])[0]
    return pred_label, probs[0][pred_id].item()

# ds-r1
# print(predict("【旱魃肆虐：中国\"苹果之乡\"遭遇三十年最严峻考验】\n持续蔓延的极端干旱天气正在啃噬中国最重要的苹果产区。在陕西洛川，果农张东汉蹲在自家果园里，抓起一把干燥的黄土任其从指缝流散——这片孕育了8年的500亩苹果园正经历史无前例的生存危机。\n\"树上的果子还挂着，但地下的命脉已经断了。\"这位资深果农的忧虑背后，是一组惊人的产业数据：作为全球苹果产业的心脏地带，陕西一省就贡献着全国27%的产量，其每片果园的震颤都将影响整个行业的脉搏。\n今年开春以来，三秦大地接连遭受气候的连环暴击：先是倒春寒的霜冻掐灭花芽，继而冰雹砸伤幼果，如今持续数月的干旱正抽干土壤最后的生机。在农业气象站的记录里，这样\"旱冻雹\"三灾叠加的极端情况，还是三十年来头一遭。\n这场气候危机正在改写中国农产品的生产剧本。从黄土高原到华北平原，越来越多的经济作物区发现，传统耕作经验已难以应对愈发狂暴的自然之力。当\"三十年一遇\"逐渐变成\"三年一遇\"，背后折射的不仅是农户的生计困境，更是整个农业体系必须直面的气候适应考题。\n在张东汉的果园里，那些尚挂在枝头却注定减产三成的苹果，或许将成为中国农产品应对气候变化的又一枚警示标本。"))

# gpt-4o-mini
# print(predict("近期，我国多地遭遇罕见大旱，干旱范围广、程度深、持续时间长，给农业生产带来了沉重打击。\n“今年是三十年来最严重的一次干旱，”陕西果品合作社负责人张东汉向虎嗅ESG组表示，\n“树上的果子和叶子看着还算正常，可地里的土已经干裂得不行了，照这样下去，损失会非常惨重。”\n张东汉经营果园已有八年，管理着500亩苹果园和100多亩其他应季水果。他坦言，今年是最难熬的一年。\n从整体数据来看，中国不仅是全球最大的苹果生产国，也是消费大国，苹果产量占全球总产量的57.6%，位居世界第一。\n其中，陕西长期稳居全国苹果产量首位，被誉为中国苹果种植的优生区。\n据《陕西省统计年鉴》数据显示，2022年陕西苹果种植面积达到924.10万亩，占全国比重约31.07%；产量达1302.71万吨，占全国总产量的27.03%。\n张东汉的果园只是众多受灾果园中的一个缩影。今年整个陕西不仅面临严重干旱，还遭遇了霜冻和冰雹等极端天气，果农们正经历着前所未有的挑战。\n不可忽视的是，极端天气事件日益频繁，气温持续升高，降水规律发生变化……这一系列气候变化正在深刻影响农业生产、农户生计，甚至关系到国家粮食安全。\n"))

# ds-r1
# print(predict("【苹果困局：当传统农业遇上气候无常】\n绿色和平最新调研报告直指渭塬市苹果产业困境——技术革新才是破局关键。\n“一年比一年难干，一年比一年贱卖”，这种“靠天吃饭”的老路正越走越窄。传统种植模式让果农在市场的惊涛骇浪和反复无常的天气面前，显得尤为无力。\n无论是智能种植系统、灾害预警技术，还是机械化采收设备，新技术的引入或许能让这片土地重焕生机，帮助农户摆脱“看老天脸色”的被动局面。\n“种地讲究天时地利人和，一步错步步错。”张东汉的感慨里透着无奈，“选错了地方，人再拼命也斗不过老天。”这位老果农话锋一转，又带着几分禅意：“西安那场冰雹砸烂的豪车，几百万说没就没。相比之下，我们至少还有土地在。”\n每年丰收季，东汉都会按老规矩给老天爷“上供”——或杀猪，或宰羊。在他心里，始终笃信那句老话：“七分在人，三分在天。”只是如今，那“三分天意”正变得越来越难以捉摸。"))

# qwen
print(predict("\n \n\"技术赋能或是渭塬苹果产业破局关键。\"绿色和平最新发布的调研报告揭示，面对\"年年辛劳换低价\"的困局，传统种植模式已难撑大局。报告显示，当市场波动与气候风险叠加，依赖经验种植的果农群体正沦为最脆弱的链条。 \n \n智能化种植、防灾体系升级、机械化作业等现代技术的引入，被视作扭转困局的突破口。这些创新要素如同为黄土地注入活水，或将终结农户\"看天收成\"的历史窘境。正如当地果农东汉所言：\"种地讲究天时地利人和，选错位置就别想赢过老天爷。\" \n \n这位有着二十年种植经验的老农，用独特方式诠释着人与自然的关系。每年他都会举行\"上供\"仪式——轮换着宰杀猪羊献祭，这个延续多年的习俗背后，是\"七分靠打拼，三分天注定\"的朴素哲学。他指着被冰雹损毁的西安二手车场举例：\"几百万的车说没就没，但我们至少还守着这片土地。\" \n \n在现代农业科技与传统耕作智慧的碰撞中，渭塬苹果产业正站在转型的十字路口。如何平衡技术投入与自然规律，或许将决定百万果农的未来命运。"))